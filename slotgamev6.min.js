function addListener(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}else{e["on"+t]=n}}function eventWindowLoaded(){slotGameApp()}function slotGameApp(){if(!Modernizr.canvas){alert("Slot machine game is not supported on this browser. Please use IE 9.0, Chrome or Firefox");return}(function(){function r(){}function s(){}function o(){}function u(){}function a(){}function f(){if(arguments.length==0){throw new Error("Missing animation parameter map")}var e=arguments[0];this.isJackpot=e["isJackpot"];this.endTime=e["duration"];this.reel=e["reel"];this.stopIndex=this.isJackpot?this.reel.indexOfGrandPrizePiece():this.reel.indexOfAnyNonGrandPrizePiece();this.stopY=e["stopY"];this.refreshInterval=e["refreshInterval"];this.lo=e["lo"];this.hi=e["hi"];this.context=e["context"];this.verticalShift=e["verticalShift"]}function p(){if(Modernizr.audio.wav=="probably"||Modernizr.audio.wav=="maybe")return"wav";else if(Modernizr.audio.mp3=="probably"||Modernizr.audio.mp3=="maybe")return"mp3";return""}function T(){window.location.reload()}var e=document.getElementById("canvas"),t=e.getContext("2d");e.width=window.innerWidth||document.body.clientWidth;e.height=window.innerHeight||document.body.clientHeight;e.width-=10;e.height-=10;var n={};n.reelMargin=10;n.reelWidth=270;n.reelHeight=600;n.pieceWidth=250;n.pieceHeight=300;n.indicatorHeight=20;n.canvasOffsetLeft=0;n.canvasOffsetTop=0;n.yshift=50;n.frameRate=60;n.refreshInterval=1e3/n.frameRate;n.spinsToGrandPrize=15;r.prototype.x=0;r.prototype.y=0;r.prototype.width=0;r.prototype.height=0;r.prototype.draw=function(e){throw new Error("Not Implemented")};s.prototype=new r;s.prototype.__proto__=r.prototype;s.prototype.reels=[];s.prototype.indicators=[];s.prototype.draw=function(e){e.fillStyle="#000000";e.fillRect(0,0,this.width,this.height);var t=e.createLinearGradient(0,this.y,0,this.y+this.height);t.addColorStop(0,"rgb(25,230,25)");t.addColorStop(.25,"rgb(50,230,50)");t.addColorStop(.5,"rgb(50,80,50)");t.addColorStop(.75,"rgb(50,230,50)");t.addColorStop(1,"rgb(25,230,25)");e.fillStyle=t;e.fillRect(this.x,this.y,this.width,this.height);var n=0,r=this.indicators.length;for(;n<r;){this.indicators[n++].draw(e)}n=0;r=this.reels.length;for(;n<r;){this.reels[n++].draw(e)}};o.prototype=new r;o.prototype.__proto__=r.prototype;o.prototype.x2=function(){return this.isPointingRight?this.x+this.width:this.x-this.width};o.prototype.y2=function(){return this.y+this.height/2};o.prototype.x3=function(){return this.x};o.prototype.y3=function(){return this.y+this.height};o.prototype.isPointingRight=true;o.prototype.draw=function(e){e.fillStyle="#ffffff";e.beginPath();e.moveTo(this.x,this.y);e.lineTo(this.x2(),this.y2());e.lineTo(this.x3(),this.y3());e.lineTo(this.x,this.y);e.fill();e.closePath()};u.prototype=new r;u.prototype.__proto__=r.prototype;u.prototype.pieces=[];u.prototype.indexOfAnyNonGrandPrizePiece=function(){var e=0,t=this.pieces.length,n=this.indexOfGrandPrizePiece(),r=[];for(;e<t;e++){if(!this.pieces[e].isGrandPrize){r.push(e)}}return r[Math.floor(Math.random()*r.length)]};u.prototype.draw=function(e){var t=e.createLinearGradient(0,this.y,0,this.y+this.height);t.addColorStop(0,"rgb(50,50,50)");t.addColorStop(.5,"rgb(255,255,255)");t.addColorStop(1,"rgb(50,50,50)");e.fillStyle=t;e.fillRect(this.x,this.y,this.width,this.height);this.drawPieces(e)};u.prototype.drawPieces=function(e){var t=0,n=this.pieces.length;for(;t<n;){this.pieces[t++].draw(e)}};u.prototype.movePieces=function(e,t,n){var r=0,i=this.pieces.length;for(;r<i;){this.pieces[r++].move(e,t,n)}};u.prototype.indexOfGrandPrizePiece=function(){var e=0,t=this.pieces.length,n=-1;for(;e<t;e++){if(this.pieces[e].isGrandPrize){n=e;break}}return n};a.prototype=new r;a.prototype.__proto__=r.prototype;a.prototype.dx=0;a.prototype.dy=0;a.prototype.image=null;a.prototype.isGrandPrize=false;a.prototype.reel=null;a.prototype.draw=function(e){if(!this.image||!this.reel)return;var t=this.y+this.dy,n=t+this.height,r=this.reel.y,i=this.reel.y+this.reel.height;if(n<=r||t>=i){return}else if(t<r){var s=n-r;e.drawImage(this.image,0,this.height-s,this.width,s,this.x,r,this.width,s)}else if(n>i){var s=this.height-(n-i);e.drawImage(this.image,0,0,this.width,s,this.x,t,this.width,s)}else{e.drawImage(this.image,this.x,t,this.width,this.height)}};a.prototype.move=function(e,t,n){this.dy+=e;if(this.y+this.dy>n){this.dy=this.y+this.dy-n;this.y=t}};f.prototype.isJackpot=false;f.prototype.stopIndex=-1;f.prototype.stopY=0;f.prototype.elapsedTime=0;f.prototype.endTime=0;f.prototype.ended=false;f.prototype.reel=null;f.prototype.refreshInterval=0;f.prototype.verticalShift=0;f.prototype.lo=0;f.prototype.hi=0;f.prototype.context=null;f.prototype.tick=function(){if(this.ended==true)return;var e=this.reel.pieces[this.stopIndex],t=this.stopY-(e.y+e.dy),n=Math.abs(t)<=this.verticalShift;if(this.elapsedTime>=this.endTime&&n){this.reel.movePieces(t,this.lo,this.hi);this.ended=true}else{this.reel.movePieces(this.verticalShift,this.lo,this.hi);this.elapsedTime+=this.refreshInterval}this.reel.draw(this.context)};var l=7;var c=0;var h=function(){c++;if(c>=l){var r=[[v,d,m,g,y],[d,v,g,y,m],[v,y,m,g,d]],h=0,p=true,E=r.length,S=(e.width-(E*n.reelWidth+(E-1)*n.reelMargin))/2,x=(e.height-n.reelHeight)/2,T=x-1.5*n.pieceHeight,N=T+5*n.pieceHeight,C=T,k=(n.reelWidth-n.pieceWidth)/2;pieceMinX=S+k;pieceInitialX=pieceMinX,piece=null,reel=null,stage=null,pieces=null,config=null,leftIndicator=null,rightIndicator=null,reels=[],i=0,j=0;stage=new s;stage.x=S-n.reelMargin;stage.y=x-n.reelMargin;stage.height=n.reelHeight+2*n.reelMargin;stage.width=n.reelWidth*E+n.reelMargin*(E+1);leftIndicator=new o;leftIndicator.height=n.indicatorHeight;leftIndicator.width=n.reelMargin;leftIndicator.x=S-n.reelMargin;leftIndicator.y=x+(n.reelHeight-n.indicatorHeight)/2;leftIndicator.isPointingRight=true;rightIndicator=new o;rightIndicator.height=n.indicatorHeight;rightIndicator.width=n.reelMargin;rightIndicator.x=S+E*(n.reelWidth+n.reelMargin);rightIndicator.y=x+(n.reelHeight-n.indicatorHeight)/2;rightIndicator.isPointingRight=false;stage.indicators=[leftIndicator,rightIndicator];for(;i<E;i++){config=r[i];pieces=[];reel=new u;reel.x=S;reel.y=x;reel.width=n.reelWidth;reel.height=n.reelHeight;j=0;for(;j<config.length;j++){piece=new a;piece.x=pieceInitialX;piece.y=C;piece.width=n.pieceWidth;piece.height=n.pieceHeight;piece.image=config[j];piece.isGrandPrize=piece.image==d;piece.reel=reel;pieces.push(piece);C+=n.pieceHeight}reel.pieces=pieces;reels.push(reel);C=T;S+=n.reelWidth+n.reelMargin;pieceInitialX=S+k}stage.reels=reels;stage.draw(t);addListener(e,"click",L);function L(e){function r(){w.currentTime=0;w.pause();b.play();var e=x+.5*n.pieceHeight,r=false;if(h<n.spinsToGrandPrize){h++;r=false}else{h=0;r=true}var s={};s.isJackpot=r;s.stopY=e;s.verticalShift=n.yshift;s.lo=T;s.hi=N;s.refreshInterval=n.refreshInterval;s.context=t;var o=function(e,t){var n={};for(var r in e){if(e.hasOwnProperty(r)){n[r]=e[r]}}for(var r in t){if(t.hasOwnProperty(r)){n[r]=t[r]}}return n},u=function c(e,t,n){if(!e||e.length==0)return n;n=t(e[0],n);return c(e.slice(1),t,n)},a=function d(e,t){if(!e||e.length==0)return;t(e[0]);d(e.slice(1),t)};reelAnimations=[],i=0,len=stage.reels.length,duration=1e3;for(;i<len;i++){reelAnimations.push(new f(o({reel:stage.reels[i],duration:duration},s)));duration+=200}console.log(reelAnimations[0]);var l=setInterval(function(){var e=true;e=u(reelAnimations,function(e,t){t=t&&e.ended;return t},e);if(e&&b.ended){clearInterval(l);b.currentTime=0;b.pause();var t={};t.previousPiece=null;t.allMatches=true;t=u(reelAnimations,function(e,n){var r=e.reel.pieces[e.stopIndex];if(t.previousPiece){t.allMatches=t.allMatches&&t.previousPiece.image==r.image}t.previousPiece=r;return t},t);if(t.allMatches&&r){w.play()}p=true}else{a(reelAnimations,function(e){e.tick()})}},n.refreshInterval)}if(p==true){p=false;r()}}}};var d=new Image;d.src="seven.png";d.onload=h;var v=new Image;v.src="oranges.png";v.onload=h;var m=new Image;m.src="grapes.png";m.onload=h;var g=new Image;g.src="diamond.png";g.onload=h;var y=new Image;y.src="watermelon.png";y.onload=h;var b=document.createElement("audio");document.body.appendChild(b);var w=document.createElement("audio");document.body.appendChild(w);var E=p(),S=false,x=false;if(E!=""){b.setAttribute("src","spinning01."+E);addListener(b,"canplaythrough",function(){if(S){return}h();S=true});b.load();w.setAttribute("src","cheering01."+E);addListener(w,"canplaythrough",function(){if(x){return}h();x=true});w.load()}addListener(window,"resize",T)})()}addListener(window,"load",eventWindowLoaded)